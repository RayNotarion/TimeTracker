<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Time Tracker</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
  />
</head>

<body class="bg-gradient-to-br from-indigo-100 to-purple-100 min-h-screen p-6">

  <div class="bg-white shadow-2xl rounded-2xl w-full max-w-6xl mx-auto p-8 mt-4">

    <!-- Header -->
    <h1 class="text-4xl font-bold text-center text-indigo-600 mb-8 flex items-center justify-center gap-3">
      <i class="fa-solid fa-clock"></i>
      Time Tracker
    </h1>

    <!-- Inputs -->
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">

      <div class="relative">
        <i class="fa-solid fa-calendar-day absolute left-3 top-1/2 -translate-y-1/2 text-indigo-400"></i>
        <input id="date" type="date"
          class="w-full border rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-indigo-400" />
      </div>

      <div class="relative">
        <i class="fa-solid fa-play absolute left-3 top-1/2 -translate-y-1/2 text-indigo-400"></i>
        <input id="start" type="time"
          class="w-full border rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-indigo-400" />
      </div>

      <div class="relative">
        <i class="fa-solid fa-stop absolute left-3 top-1/2 -translate-y-1/2 text-indigo-400"></i>
        <input id="end" type="time"
          class="w-full border rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-indigo-400" />
      </div>

      <button onclick="addEntry()"
        class="md:col-span-2 bg-indigo-600 text-white rounded-lg px-6 py-2 font-semibold hover:bg-indigo-700 transition transform hover:scale-105 flex items-center justify-center gap-2">
        <i class="fa-solid fa-plus"></i>
        Add Time Entry
      </button>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto rounded-xl border mb-6">
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-indigo-100 text-indigo-700">
            <th class="p-4 text-left">Date</th>
            <th class="p-4 text-left">Start</th>
            <th class="p-4 text-left">End</th>
            <th class="p-4 text-left">Duration</th>
            <th class="p-4 text-center">Action</th>
          </tr>
        </thead>
        <tbody id="list" class="divide-y"></tbody>
      </table>
    </div>

    <!-- Total -->
    <div class="flex justify-between items-center bg-indigo-50 p-5 rounded-xl">
      <span class="font-semibold text-indigo-700 text-xl flex items-center gap-2">
        <i class="fa-solid fa-chart-pie"></i>Total Time
      </span>
      <span id="total" class="text-3xl font-bold text-indigo-600">0h 0m</span>
    </div>
  </div>

  <script>
    let entries = [];
    let totalMinutes = 0;

    function formatTime(time) {
      const [hour, minute] = time.split(":").map(Number);
      const ampm = hour >= 12 ? "PM" : "AM";
      const hour12 = hour % 12 || 12;
      return `${hour12}:${minute.toString().padStart(2, "0")} ${ampm}`;
    }

    function formatDate(date) {
      return new Date(date).toLocaleDateString("en-US", {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    function saveToStorage() {
      localStorage.setItem("timeEntries", JSON.stringify(entries));
      localStorage.setItem("totalMinutes", totalMinutes);
    }

    function loadFromStorage() {
      entries = JSON.parse(localStorage.getItem("timeEntries")) || [];
      totalMinutes = parseInt(localStorage.getItem("totalMinutes")) || 0;
      refreshTable();
      updateTotal();
    }

    function showEmptyMessage() {
      if (entries.length === 0) {
        document.getElementById("list").innerHTML = `
          <tr>
            <td colspan="5" class="p-8 text-center text-gray-400">
              <i class="fa-solid fa-clock text-4xl mb-3 block"></i>
              No time entries yet. Add one above 
            </td>
          </tr>
        `;
      }
    }

    function addRow(entry, index) {
      const row = `
        <tr class="hover:bg-gray-50">
          <td class="p-4">${formatDate(entry.date)}</td>
          <td class="p-4">${formatTime(entry.start)}</td>
          <td class="p-4">${formatTime(entry.end)}</td>
          <td class="p-4 font-semibold text-indigo-600">
            ${entry.hours}h ${entry.minutes}m
          </td>
          <td class="p-4 text-center">
            <button onclick="deleteEntry(${index})"
              class="text-red-500 hover:text-red-700">
              <i class="fa-solid fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
      document.getElementById("list").insertAdjacentHTML("beforeend", row);
    }

    function refreshTable() {
      document.getElementById("list").innerHTML = "";
      if (entries.length === 0) {
        showEmptyMessage();
        return;
      }
      entries.forEach((entry, index) => addRow(entry, index));
    }

    function addEntry() {
      const date = document.getElementById("date").value;
      const start = document.getElementById("start").value;
      const end = document.getElementById("end").value;

      if (!date || !start || !end) {
        Swal.fire({ icon: "error", title: "Missing Fields" });
        return;
      }

      const startTime = new Date(`${date}T${start}`);
      const endTime = new Date(`${date}T${end}`);

      if (endTime <= startTime) {
        Swal.fire({ icon: "warning", title: "Invalid Time Range" });
        return;
      }

      const diffMinutes = Math.floor((endTime - startTime) / 60000);
      totalMinutes += diffMinutes;

      entries.push({
        date,
        start,
        end,
        hours: Math.floor(diffMinutes / 60),
        minutes: diffMinutes % 60,
        minutesTotal: diffMinutes
      });

      refreshTable();
      updateTotal();
      saveToStorage();

      Swal.fire({ icon: "success", title: "Time Added!", timer: 1200, showConfirmButton: false });

      document.getElementById("start").value = "";
      document.getElementById("end").value = "";
    }

    function deleteEntry(index) {
      Swal.fire({
        title: "Delete this entry?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#dc2626",
        confirmButtonText: "Delete"
      }).then(result => {
        if (result.isConfirmed) {
          totalMinutes -= entries[index].minutesTotal;
          entries.splice(index, 1);
          refreshTable();
          updateTotal();
          saveToStorage();

          Swal.fire({ icon: "success", title: "Deleted!", timer: 1000, showConfirmButton: false });
        }
      });
    }

    function updateTotal() {
      const h = Math.floor(totalMinutes / 60);
      const m = totalMinutes % 60;
      document.getElementById("total").textContent = `${h}h ${m}m`;
    }

    document.getElementById("date").valueAsDate = new Date();
    loadFromStorage();
  </script>

</body>
</html>
